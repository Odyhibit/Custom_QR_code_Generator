<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>QR Code Generator</h1>
            <p class="subtitle">Create custom QR codes with logos and styling</p>
        </header>

        <!-- Step Navigation -->
        <nav class="step-nav">
            <button class="step-btn active" data-step="1">
                <span class="step-num">1</span>
                <span class="step-label">Content</span>
            </button>
            <div class="step-divider"></div>
            <button class="step-btn" data-step="2">
                <span class="step-num">2</span>
                <span class="step-label">Logo/Padding</span>
            </button>
            <div class="step-divider"></div>
            <button class="step-btn" data-step="3">
                <span class="step-num">3</span>
                <span class="step-label">Style</span>
            </button>
            <div class="step-divider"></div>
            <button class="step-btn" data-step="4">
                <span class="step-num">4</span>
                <span class="step-label">Export</span>
            </button>
        </nav>

        <!-- Step 1: Content -->
        <section id="step1" class="step-section active">
            <!-- Type Selector -->
            <div class="type-selector">
                <div class="type-card active" data-type="text">
                    <div class="type-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M2.5 4v3h5v12h3V7h5V4h-13zm19 5h-9v3h3v7h3v-7h3V9z"/></svg>
                    </div>
                    <span class="type-name">Text</span>
                </div>
                <div class="type-card" data-type="url">
                    <div class="type-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>
                    </div>
                    <span class="type-name">URL</span>
                </div>
                <div class="type-card" data-type="vcard">
                    <div class="type-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    </div>
                    <span class="type-name">Contact</span>
                </div>
                <div class="type-card" data-type="phone">
                    <div class="type-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
                    </div>
                    <span class="type-name">Phone</span>
                </div>
                <div class="type-card" data-type="sms">
                    <div class="type-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/></svg>
                    </div>
                    <span class="type-name">SMS</span>
                </div>
                <div class="type-card" data-type="email">
                    <div class="type-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
                    </div>
                    <span class="type-name">Email</span>
                </div>
                <div class="type-card" data-type="wifi">
                    <div class="type-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"/></svg>
                    </div>
                    <span class="type-name">WiFi</span>
                </div>
                <div class="type-card" data-type="event">
                    <div class="type-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/></svg>
                    </div>
                    <span class="type-name">Event</span>
                </div>
                <div class="type-card" data-type="geo">
                    <div class="type-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                    </div>
                    <span class="type-name">Location</span>
                </div>
            </div>

            <!-- Dynamic Form -->
            <div class="form-container">
                <form id="inputForm">
                    <!-- Fields injected by JS -->
                </form>
            </div>

            <!-- Actions -->
            <div class="step-actions step-actions-split" style="max-width: 480px; margin-left: auto; margin-right: auto;">
                <div>
                    <input type="file" id="projectFileInput" accept=".json" hidden>
                    <button type="button" class="btn btn-secondary" id="loadProjectBtn">Load Project</button>
                </div>
                <button type="button" class="btn btn-primary" id="nextBtn1">
                    Continue
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                </button>
            </div>
        </section>


        <!-- Step 2: Logo (Optional) -->
        <section id="step2" class="step-section">
            <div class="logo-step-layout">
                <!-- Logo Canvas -->
                <div class="logo-canvas-container">
                    <!-- Paint mode controls (hidden until editable cells exist) -->
                    <div id="paintModeControls" class="paint-mode-controls" style="display: none;">
                        <div class="mode-toggle">
                            <button type="button" class="mode-btn" data-mode="logo" id="moveLogoBtn" disabled>Move Logo</button>
                            <button type="button" class="mode-btn active" data-mode="paint">Paint Modules</button>
                        </div>
                        <div id="brushControls" class="brush-controls">
                            <button type="button" class="brush-btn active" data-brush="black" title="Black">&#9632;</button>
                            <button type="button" class="brush-btn" data-brush="white" title="White">&#9633;</button>
                            <button type="button" class="brush-btn brush-reset" id="resetPaintBtn" title="Reset edits">Reset</button>
                        </div>
                        <span id="modeHint" class="mode-hint">Click to paint, Shift+drag to fill area</span>
                    </div>
                    <canvas id="logoCanvas" width="450" height="450"></canvas>
                    <p class="canvas-hint" id="logoCanvasHint">Upload a logo to position it on the QR code</p>
                </div>

                <!-- Logo Controls -->
                <div class="logo-controls-panel">
                    <div class="logo-upload-section">
                        <input type="file" id="logoInput" accept="image/*" hidden>
                        <button type="button" class="btn btn-primary btn-large" id="uploadLogoBtn">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 7v2.99s-1.99.01-2 0V7h-3s.01-1.99 0-2h3V2h2v3h3v2h-3zm-3 4V8h-3V5H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-8h-3zM5 19l3-4 2 3 3-4 4 5H5z"/></svg>
                            Upload Logo
                        </button>
                        <button type="button" class="btn btn-text" id="clearLogoBtn" style="display: none;">Remove Logo</button>
                    </div>

                    <div id="logoAdjustments" style="display: none;">
                        <div class="control-group">
                            <label>Logo Scale: <span id="logoScaleValue">100</span>%</label>
                            <input type="range" id="logoScale" min="20" max="150" value="100">
                        </div>

                    </div>

                    <!-- Canvas Size (always visible) -->
                    <div class="control-group">
                        <label>Canvas Size</label>
                        <p class="control-hint">Larger sizes allow bigger logos</p>
                        <select id="versionSelect">
                            <option value="auto">Auto</option>
                            <option value="2">Version 2 (25x25)</option>
                            <option value="3">Version 3 (29x29)</option>
                            <option value="4">Version 4 (33x33)</option>
                            <option value="5">Version 5 (37x37)</option>
                            <option value="6">Version 6 (41x41)</option>
                            <option value="8">Version 8 (49x49)</option>
                        </select>
                    </div>

                    <!-- Error Correction Level -->
                    <div class="control-group">
                        <label>Error Correction</label>
                        <p class="control-hint">Lower = more padding capacity</p>
                        <select id="eccSelect">
                            <option value="L">Low (7% recovery)</option>
                            <option value="M" selected>Medium (15% recovery)</option>
                            <option value="Q">Quartile (25% recovery)</option>
                            <option value="H">High (30% recovery)</option>
                        </select>
                    </div>

                    <!-- Optimize Mask for Logo (only when logo loaded) -->
                    <div id="optimizeMaskSection" class="control-group" style="display: none;">
                        <label>Optimize Pattern</label>
                        <p class="control-hint">Find the best mask pattern to match logo dark/light areas</p>
                        <button type="button" class="btn btn-secondary" id="optimizeMaskBtn" style="width: 100%;">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M19 9l1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25L19 9zm-7.5.5L9 4 6.5 9.5 1 12l5.5 2.5L9 20l2.5-5.5L17 12l-5.5-2.5zM19 15l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25L19 15z"/></svg>
                            Match Padding to Logo
                        </button>
                        <p id="optimizeResult" class="control-hint" style="margin-top: 8px; display: none;"></p>
                    </div>
                </div>
            </div>

            <!-- Step Actions -->
            <div class="step-actions step-actions-split">
                <button type="button" class="btn btn-secondary" id="backBtn2">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                    Back
                </button>
                <button type="button" class="btn btn-primary" id="nextBtn2">
                    Continue
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                </button>
            </div>
        </section>

        <!-- Step 3: Style & Export -->
        <section id="step3" class="step-section">
            <div class="style-layout">
                <!-- Main Preview -->
                <div class="preview-main">
                    <canvas id="mainCanvas" width="500" height="500"></canvas>
                </div>

                <!-- Controls Panel -->
                <div class="controls-panel">

                    <!-- Finder Shape -->
                    <div class="control-group">
                        <h3>Finder Shape</h3>
                        <div class="shape-selector">
                            <button class="shape-btn finder-shape-btn" data-finder="square" title="Square">
                                <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" fill="currentColor"/><rect x="6" y="6" width="12" height="12" fill="white"/><rect x="8" y="8" width="8" height="8" fill="currentColor"/></svg>
                            </button>
                            <button class="shape-btn finder-shape-btn active" data-finder="rounded" title="Rounded">
                                <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" fill="currentColor"/><rect x="6" y="6" width="12" height="12" rx="1.5" fill="white"/><rect x="8" y="8" width="8" height="8" rx="1" fill="currentColor"/></svg>
                            </button>
                            <button class="shape-btn finder-shape-btn" data-finder="circle" title="Circle">
                                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="currentColor"/><circle cx="12" cy="12" r="7" fill="white"/><circle cx="12" cy="12" r="4.5" fill="currentColor"/></svg>
                            </button>
                            <button class="shape-btn finder-shape-btn" data-finder="hybrid" title="Hybrid">
                                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="currentColor"/><circle cx="12" cy="12" r="7" fill="white"/><rect x="8" y="8" width="8" height="8" fill="currentColor"/></svg>
                            </button>
                            <button class="shape-btn finder-shape-btn" data-finder="hybrid-inverse" title="Hybrid Inverse">
                                <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" fill="currentColor"/><rect x="6" y="6" width="12" height="12" fill="white"/><circle cx="12" cy="12" r="4.5" fill="currentColor"/></svg>
                            </button>
                        </div>
                        <div class="finder-colors">
                            <div class="finder-color-swatch">
                                <input type="color" id="finderOuterColor" value="#000000">
                                <span>Outer</span>
                            </div>
                            <div class="finder-color-swatch">
                                <input type="color" id="finderMiddleColor" value="#ffffff">
                                <span>Middle</span>
                            </div>
                            <div class="finder-color-swatch">
                                <input type="color" id="finderCenterColor" value="#000000">
                                <span>Center</span>
                            </div>
                        </div>
                        <label class="checkbox-inline" style="display: flex; align-items: center; gap: 8px; margin-top: 8px; cursor: pointer;">
                            <input type="checkbox" id="finderFullSeparator">
                            <span style="font-size: 13px;">Full-sized separators</span>
                        </label>
                    </div>

                    <!-- Module Shape -->
                    <div class="control-group">
                        <h3>Module Shape</h3>
                        <div class="shape-selector">
                            <button class="shape-btn" data-shape="square" title="Square">
                                <svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" fill="currentColor"/></svg>
                            </button>
                            <button class="shape-btn" data-shape="circle" title="Circle">
                                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="8" fill="currentColor"/></svg>
                            </button>
                            <button class="shape-btn" data-shape="rounded" title="Rounded">
                                <svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="3" fill="currentColor"/></svg>
                            </button>
                            <button class="shape-btn" data-shape="diamond" title="Diamond">
                                <svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" transform="rotate(45 12 12)" fill="currentColor"/></svg>
                            </button>
                            <button class="shape-btn active" data-shape="cushion" title="Cushion">
                                <svg viewBox="0 0 24 24"><path d="M12 4 Q14.8 9.2 20 12 Q14.8 14.8 12 20 Q9.2 14.8 4 12 Q9.2 9.2 12 4Z" fill="currentColor"/></svg>
                            </button>
                        </div>
                    </div>



                    <!-- Module Size -->
                    <div class="control-group">
                        <h3>Module Size: <span id="moduleSizeValue">80</span>%</h3>
                        <input type="range" id="moduleSize" min="20" max="100" value="80">
                    </div>

                    <!-- Simple Module Colors (visible when no logo) -->
                    <div id="simpleColorMode" class="control-group">
                        <h3>Module Colors</h3>
                        <div class="palette-display" style="display: block;">
                            <div class="palette-row">
                                <span class="palette-label">Dark</span>
                                <input type="color" id="simpleDarkColor" value="#000000">
                            </div>
                            <div class="palette-row">
                                <span class="palette-label">Light</span>
                                <input type="color" id="simpleLightColor" value="#ffffff">
                            </div>
                        </div>
                    </div>

                    <!-- Module Colors (visible when logo loaded) -->
                    <div id="moduleColorMode" class="control-group" style="display: none;">
                        <h3>Module Colors</h3>
                        <select id="colorMode">
                            <option value="default">Black & White</option>
                            <option value="palette" selected>Palette from Logo</option>
                            <option value="gradient">Gradient from Logo</option>
                        </select>

                        <!-- Palette Color Pickers (shown when palette mode) -->
                        <div id="paletteDisplay" class="palette-display" style="display: none;">
                            <div class="palette-row">
                                <span class="palette-label">Dark</span>
                                <input type="color" class="palette-picker" data-type="dark" data-index="0">
                                <input type="color" class="palette-picker" data-type="dark" data-index="1">
                                <input type="color" class="palette-picker" data-type="dark" data-index="2">
                                <input type="color" class="palette-picker" data-type="dark" data-index="3">
                            </div>
                            <div class="palette-row">
                                <span class="palette-label">Light</span>
                                <input type="color" class="palette-picker" data-type="light" data-index="0">
                                <input type="color" class="palette-picker" data-type="light" data-index="1">
                                <input type="color" class="palette-picker" data-type="light" data-index="2">
                                <input type="color" class="palette-picker" data-type="light" data-index="3">
                            </div>
                            <p class="control-hint">Click any color to customize</p>
                        </div>

                        <!-- Gradient Controls (shown when gradient mode) -->
                        <div id="gradientControls" class="gradient-controls" style="display: none;">
                            <label>Dark Max Brightness: <span id="darkLumValue">33</span>%</label>
                            <input type="range" id="darkMaxLum" min="0" max="50" value="33">
                            <label>Light Min Brightness: <span id="lightLumValue">66</span>%</label>
                            <input type="range" id="lightMinLum" min="50" max="100" value="66">
                        </div>
                    </div>

                    <!-- Background Fill (visible when logo loaded) -->
                    <div id="backgroundFillGroup" class="control-group" style="display: none;">
                        <h3>Background Fill</h3>
                        <select id="backgroundFill">
                            <option value="light">Light (from logo)</option>
                            <option value="dark">Dark (from logo)</option>
                        </select>
                    </div>

                </div>
            </div>

            <!-- Step 3 Actions -->
            <div class="step-actions step-actions-split">
                <button type="button" class="btn btn-secondary" id="backBtn3">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                    Back
                </button>
                <button type="button" class="btn btn-primary" id="nextBtn3">
                    Continue
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                </button>
            </div>
        </section>

        <!-- Step 4: Delete & Export -->
        <section id="step4" class="step-section">
            <div class="delete-step-layout">
                <!-- Left: Canvas area -->
                <div class="delete-canvas-container">
                    <!-- Mode controls -->
                    <div id="deletePaintModeControls" class="paint-mode-controls">
                        <div class="mode-toggle">
                            <button type="button" class="mode-btn active" data-mode="delete">Delete Codewords</button>
                            <button type="button" class="mode-btn" data-mode="paint">Paint Deleted</button>
                        </div>
                        <div id="deleteBrushControls" class="brush-controls" style="display: none;">
                            <button type="button" class="brush-btn active" data-brush="black" title="Black">&#9632;</button>
                            <button type="button" class="brush-btn" data-brush="white" title="White">&#9633;</button>
                        </div>
                        <span id="deleteModeHint" class="mode-hint">Click to delete/restore codewords</span>
                    </div>
                    <canvas id="deleteCanvas" width="500" height="500"></canvas>
                    <div id="deleteHoverIndicator" class="delete-hover-indicator" style="display: none;"></div>
                </div>

                <!-- Right: Side panel -->
                <div class="delete-side-panel">
                    <!-- Summary -->
                    <div class="delete-summary">
                        <div class="delete-summary-row">
                            <span>Total Codewords:</span>
                            <strong id="deleteTotalCodewords">0</strong>
                        </div>
                        <div class="delete-summary-row">
                            <span>Deleted:</span>
                            <strong id="deleteDeletedCount">0</strong>
                        </div>
                    </div>

                    <!-- Block Legend -->
                    <div id="deleteBlockLegend" class="delete-block-legend"></div>

                    <!-- Reset Button -->
                    <button type="button" class="btn btn-secondary" id="resetDeletionsBtn" style="width: 100%; justify-content: center; margin-bottom: 20px;">
                        Reset Deletions
                    </button>

                    <!-- Hide Deleted Preview -->
                    <label class="checkbox-inline" style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px; cursor: pointer;">
                        <input type="checkbox" id="hideDeletedPreview">
                        <span style="font-size: 13px;">Hide deleted outlines</span>
                    </label>

                    <!-- Quiet Zone -->
                    <div class="control-group">
                        <h3>Quiet Zone: <span id="quietZoneValue">2</span> modules</h3>
                        <input type="range" id="quietZone" min="0" max="4" value="2">
                    </div>

                    <!-- Export -->
                    <div class="control-group export-group">
                        <h3>Export</h3>
                        <div class="export-buttons">
                            <button type="button" class="btn btn-primary export-delete-btn" data-size="512">Download 512px</button>
                            <button type="button" class="btn btn-primary export-delete-btn" data-size="1024">Download 1024px</button>
                        </div>
                    </div>

                    <!-- Save Project -->
                    <button type="button" class="btn btn-secondary" id="saveProjectBtn"
                        style="width: 100%; justify-content: center; margin-top: 12px;">
                        Save Project
                    </button>
                </div>
            </div>

            <!-- Step Actions -->
            <div class="step-actions step-actions-split">
                <button type="button" class="btn btn-secondary" id="backBtn4">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                    Back
                </button>
            </div>
        </section>
    </div>

    <!-- Scripts -->
    <script src="core/qr-block-tables.js"></script>
    <script src="core/qr-reed-solomon.js"></script>
    <script src="core/qr-utils.js"></script>
    <script src="core/encoder-core.js"></script>
    <script src="js/qr-types.js"></script>
    <script src="js/color-utils.js"></script>
    <script src="js/qr-renderer.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
